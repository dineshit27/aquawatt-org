import{j as e,C as U,a as _,b as $,d as B,r as s,s as w,g as M,h as z}from"./index-pyDnZmym.js";import{D as K,a as P}from"./DashboardHeader-PAEKF7nm.js";import{L as q}from"./lightbulb-90Qseq-2.js";import{R as G,L as H,C as O,X,Y,T as J,a as Q,b as W}from"./LineChart-CKDyU7Io.js";import"./label-D7uTkZ5E.js";function u({title:l,type:i,value:m,change:n,className:h}){const g=i==="water"?K:q,j=i==="water"?"text-blue-600":"text-yellow-600",f=i==="water"?"bg-blue-50":"bg-yellow-50",v=i==="water"?"border-blue-200":"border-yellow-200";return e.jsxs(U,{className:`overflow-hidden transition-all duration-300 hover:shadow-md hover:scale-105 border ${v} ${h}`,children:[e.jsxs(_,{className:`${f} flex flex-row items-center justify-between space-y-0 pb-4`,children:[e.jsx($,{className:"text-sm font-medium text-gray-700",children:l}),e.jsx("div",{className:"p-2 rounded-full bg-white/80",children:e.jsx(g,{className:`h-4 w-4 ${j}`})})]}),e.jsxs(B,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m}),n&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n})]})]})}const ae=()=>{const[l,i]=s.useState([]),[m,n]=s.useState(!0),[h,g]=s.useState(null),[j,f]=s.useState(0),[v,C]=s.useState(0),[b,k]=s.useState(null),[L,R]=s.useState(!1),F=83,I=s.useCallback(t=>{if(t===null||isNaN(t))return"₹0.00";const a=(t||0)*F;try{return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(a)}catch{return"₹"+a.toFixed(2)}},[]),y=s.useCallback(async()=>{var t,a;n(!0),k(null);try{const[{data:r}]=await Promise.all([w.auth.getUser()]),c=(t=r.user)==null?void 0:t.id;if(!c){i([]),g(null),f(0),C(0),n(!1);return}const[N,p,T,E]=await Promise.all([M(),z(),w.from("connected_devices").select("id, is_active").eq("user_id",c),w.from("rooms").select("id").eq("user_id",c)]),A=N.length>0&&N.every(x=>x.water>20&&x.water<70&&x.electricity>5&&x.electricity<20);R(A),i(N),g((p==null?void 0:p.total_amount)??null);const D=(T.data||[]).filter(x=>x.is_active).length;f(D>0?D:8);const S=((a=E.data)==null?void 0:a.length)||0;C(S>0?S:6)}catch(r){console.warn("Dashboard load error",r),k(r.message||"Failed to load dashboard")}finally{n(!1)}},[]);s.useEffect(()=>{y()},[y]);const o=s.useMemo(()=>{const t=l.reduce((r,c)=>r+(c.water||0),0),a=l.reduce((r,c)=>r+(c.electricity||0),0);return{water:Number(t.toFixed(2)),electricity:Number(a.toFixed(2))}},[l]),d=s.useMemo(()=>l.map(t=>({name:t.label,water:t.water,electricity:t.electricity})),[l]);return e.jsx("div",{className:"min-h-screen bg-background flex flex-col",children:e.jsxs("main",{className:"flex-1 flex flex-col w-full md:w-auto",children:[e.jsx(P,{}),e.jsxs("div",{className:"flex-1 p-6 space-y-6",children:[m&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading dashboard…"}),b&&!m&&e.jsxs("div",{className:"text-sm text-red-600 flex items-center gap-2",children:[e.jsx("span",{children:b}),e.jsx("button",{onClick:y,className:"underline",children:"Retry"})]}),!m&&!b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsx(u,{title:"Water (7d)",type:"water",value:`${o.water} L`,change:""}),e.jsx(u,{title:"Electricity (7d)",type:"electricity",value:`${o.electricity} kWh`,change:""}),e.jsx(u,{title:"Active Devices",type:"electricity",value:String(j),change:""}),e.jsx(u,{title:"Rooms",type:"water",value:String(v),change:""}),e.jsx(u,{title:"Current Bill",type:"electricity",value:h!==null?I(h):"—",change:""})]}),e.jsxs("div",{className:"bg-card p-4 sm:p-6 rounded-xl border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold",children:"Weekly Usage Trends"}),L&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Showing demo data - Connect devices to see real usage"})]}),e.jsx("button",{onClick:y,className:"text-xs underline",children:"Refresh"})]}),d.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No usage data yet. Generate activity or wait for readings."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(G,{width:"100%",height:280,children:e.jsxs(H,{data:d,children:[e.jsx(O,{strokeDasharray:"3 3",strokeOpacity:.3}),e.jsx(X,{dataKey:"name",tickMargin:8,fontSize:12,stroke:"#666"}),e.jsx(Y,{yAxisId:"left",tickMargin:8,fontSize:12,stroke:"#666",label:{value:"Usage",angle:-90,position:"insideLeft"}}),e.jsx(J,{contentStyle:{backgroundColor:"#fff",border:"1px solid #ccc",borderRadius:"8px",fontSize:"12px"},formatter:(t,a)=>[`${t} ${a.includes("Water")?"L":"kWh"}`,a]}),e.jsx(Q,{verticalAlign:"top",height:36,fontSize:12}),e.jsx(W,{yAxisId:"left",type:"monotone",dataKey:"water",stroke:"#3B82F6",strokeWidth:3,dot:{r:4,fill:"#3B82F6"},activeDot:{r:6,fill:"#1D4ED8"},name:"Water (L)"}),e.jsx(W,{yAxisId:"left",type:"monotone",dataKey:"electricity",stroke:"#10B981",strokeWidth:3,dot:{r:4,fill:"#10B981"},activeDot:{r:6,fill:"#059669"},name:"Electricity (kWh)"})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[o.water,"L"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Water"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:[o.electricity,"kWh"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Electricity"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-600",children:[d.length>0?Math.round(o.water/d.length*10)/10:0,"L"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Daily Avg Water"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-600",children:[d.length>0?Math.round(o.electricity/d.length*10)/10:0,"kWh"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Daily Avg Electricity"})]})]})]})]})]})]})]})})};export{ae as default};
