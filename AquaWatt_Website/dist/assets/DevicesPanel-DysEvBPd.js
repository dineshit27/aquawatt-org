const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-pyDnZmym.js","assets/index-IceAyytG.css"])))=>i.map(i=>d[i]);
import{c as R,v as se,r as i,A as ae,w as re,j as e,P as V,y as ie,W as ne,e as A,J as oe,i as ce,X as de,s as le,C as L,a as $,b as H,d as F,Z as ue,T as me,$ as pe,t as h,a0 as he,_ as z}from"./index-pyDnZmym.js";import{u as ve}from"./index-DMurpG-e.js";import{L as xe}from"./label-D7uTkZ5E.js";import{R as fe}from"./refresh-cw-Dtlj4at3.js";import{D as B}from"./DashboardHeader-PAEKF7nm.js";import{L as O}from"./lightbulb-90Qseq-2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=R("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=R("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=R("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var T="Switch",[_e,Te]=se(T),[we,je]=_e(T),W=i.forwardRef((s,u)=>{const{__scopeSwitch:n,name:d,checked:f,defaultChecked:w,required:g,disabled:p,value:v="on",onCheckedChange:j,form:k,...b}=s,[m,E]=i.useState(null),N=ae(u,_=>E(_)),y=i.useRef(!1),S=m?k||!!m.closest("form"):!0,[x=!1,C]=re({prop:f,defaultProp:w,onChange:j});return e.jsxs(we,{scope:n,checked:x,disabled:p,children:[e.jsx(V.button,{type:"button",role:"switch","aria-checked":x,"aria-required":g,"data-state":U(x),"data-disabled":p?"":void 0,disabled:p,value:v,...b,ref:N,onClick:ie(s.onClick,_=>{C(P=>!P),S&&(y.current=_.isPropagationStopped(),y.current||_.stopPropagation())})}),S&&e.jsx(ke,{control:m,bubbles:!y.current,name:d,value:v,checked:x,required:g,disabled:p,form:k,style:{transform:"translateX(-100%)"}})]})});W.displayName=T;var X="SwitchThumb",q=i.forwardRef((s,u)=>{const{__scopeSwitch:n,...d}=s,f=je(X,n);return e.jsx(V.span,{"data-state":U(f.checked),"data-disabled":f.disabled?"":void 0,...d,ref:u})});q.displayName=X;var ke=s=>{const{control:u,checked:n,bubbles:d=!0,...f}=s,w=i.useRef(null),g=ve(n),p=ne(u);return i.useEffect(()=>{const v=w.current,j=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(j,"checked").set;if(g!==n&&b){const m=new Event("click",{bubbles:d});b.call(v,n),v.dispatchEvent(m)}},[g,n,d]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...f,tabIndex:-1,ref:w,style:{...s.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function U(s){return s?"checked":"unchecked"}var J=W,Ne=q;const Z=i.forwardRef(({className:s,...u},n)=>e.jsx(J,{className:A("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...u,ref:n,children:e.jsx(Ne,{className:A("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Z.displayName=J.displayName;const Ie=()=>{const{translate:s}=oe(),{user:u}=ce(),[n,d]=i.useState([]),[f,w]=i.useState({}),[g,p]=i.useState(!0),[v,j]=i.useState(null),[k,b]=i.useState(!1),[m,E]=i.useState(null),[N,y]=i.useState(""),[S,x]=i.useState("water"),[C,_]=i.useState(!1),[P,I]=i.useState(null),D=i.useCallback(async()=>{if(!u){d([]),p(!1);return}p(!0),j(null);const{data:t,error:r}=await de();if(r)j(r);else{const c=Array.from(new Set((t||[]).map(a=>a.room_id).filter(Boolean)));let l={};if(c.length){const{data:a}=await le.from("rooms").select("id,name").in("id",c);a==null||a.forEach(o=>{l[o.id]=o.name}),w(l)}d((t||[]).map(a=>({...a,room_name:a.room_id?l[a.room_id]:null})))}p(!1)},[u]);i.useEffect(()=>{D()},[D]);const G=async t=>{d(l=>l.map(a=>a.id===t.id?{...a,is_active:!t.is_active}:a));const{error:r,data:c}=await pe(t.id,!!t.is_active);r||!c?(d(l=>l.map(a=>a.id===t.id?{...a,is_active:t.is_active}:a)),h({title:s("error"),description:r||"Failed to update device",variant:"destructive"})):h({title:c.is_active?s("device_activated"):s("device_deactivated"),description:`${c.device_name} ${s("is_now")} ${c.is_active?s("on"):s("off")}`})},K=async()=>{if(!u){h({title:s("error"),description:"Sign in to add devices",variant:"destructive"});return}b(!0);const t=`device_${n.length+1}`,r=n.length%3,l={device_name:t,device_type:r===0?"water":r===1?"electricity":"combo",is_active:!0},{data:a,error:o}=await he(l);o||!a?h({title:s("error"),description:o||"Failed to add device",variant:"destructive"}):(d(te=>[...te,{...a,room_name:null}]),h({title:s("success"),description:`Added ${a.device_name}`})),b(!1)},Q=t=>{E(t.id),y(t.device_name),x(t.device_type)},M=()=>{E(null),y(""),x("water")},Y=async()=>{if(m){_(!0);try{const{updateDevice:t}=await z(async()=>{const{updateDevice:a}=await import("./index-pyDnZmym.js").then(o=>o.ak);return{updateDevice:a}},__vite__mapDeps([0,1])),r=n.find(a=>a.id===m);d(a=>a.map(o=>o.id===m?{...o,device_name:N,device_type:S}:o));const{error:c,data:l}=await t(m,{device_name:N,device_type:S});c||!l?(r&&d(a=>a.map(o=>o.id===m?r:o)),h({title:s("error"),description:c||"Failed to update device",variant:"destructive"})):h({title:s("success"),description:s("device_updated")||"Device updated"})}finally{_(!1),M()}}},ee=async t=>{I(t);const{removeDevice:r}=await z(async()=>{const{removeDevice:a}=await import("./index-pyDnZmym.js").then(o=>o.ak);return{removeDevice:a}},__vite__mapDeps([0,1])),c=n;d(a=>a.filter(o=>o.id!==t));const{error:l}=await r(t);l?(d(c),h({title:s("error"),description:l,variant:"destructive"})):h({title:s("success"),description:s("device_removed")||"Device removed"}),I(null)};return u?g?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((t,r)=>e.jsxs(L,{className:"animate-pulse",children:[e.jsx($,{children:e.jsx(H,{className:"h-5 w-32 bg-muted rounded"})}),e.jsx(F,{children:e.jsx("div",{className:"h-4 w-20 bg-muted rounded"})})]},r))}):v?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-red-600",children:v}),e.jsxs("button",{onClick:D,className:"inline-flex items-center gap-1 text-sm underline",children:[e.jsx(fe,{className:"h-4 w-4"})," ",s("retry")]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:K,disabled:k,className:"inline-flex items-center gap-2 rounded bg-primary px-3 py-1.5 text-xs font-medium text-primary-foreground hover:opacity-90 disabled:opacity-50",children:[e.jsx(be,{className:"h-4 w-4"})," ",s(k?"adding":"add_device")]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[n.map(t=>{const r=m===t.id;return e.jsxs(L,{className:"transition-all duration-300 hover:shadow-md group",children:[e.jsx($,{children:e.jsxs(H,{className:"flex items-center gap-2 text-base",children:[t.device_type==="water"&&!r&&e.jsx(B,{className:"h-5 w-5 text-water-dark group-hover:scale-110 transition-transform"}),t.device_type==="electricity"&&!r&&e.jsx(O,{className:"h-5 w-5 text-energy-dark group-hover:scale-110 transition-transform"}),t.device_type==="combo"&&!r&&e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-5 w-5 text-water-dark group-hover:scale-110 transition-transform"}),e.jsx(O,{className:"h-5 w-5 text-energy-dark group-hover:scale-110 transition-transform"})]}),!r&&t.device_name,r&&e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:N,onChange:c=>y(c.target.value),placeholder:s("device_name")||"Device name"})]})}),e.jsxs(F,{className:"space-y-3",children:[r&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:S,onChange:c=>x(c.target.value),children:[e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"electricity",children:"Electricity"}),e.jsx("option",{value:"combo",children:"Combo"})]})}),!r&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{htmlFor:`device-${t.id}`,children:t.is_active?s("on"):s("off")}),e.jsx(Z,{id:`device-${t.id}`,checked:!!t.is_active,onCheckedChange:()=>G(t)})]}),t.room_name&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:t.room_name}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[!r&&e.jsxs("button",{onClick:()=>Q(t),className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded border hover:bg-muted",children:[e.jsx(ge,{className:"h-3 w-3"})," Edit"]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Y,disabled:C||!N.trim(),className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded bg-primary text-primary-foreground disabled:opacity-60",children:[e.jsx(ye,{className:"h-3 w-3"})," ",C?"Saving...":"Save"]}),e.jsxs("button",{onClick:M,disabled:C,className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded border hover:bg-muted",children:[e.jsx(ue,{className:"h-3 w-3"})," Cancel"]})]}),e.jsxs("button",{onClick:()=>ee(t.id),disabled:P===t.id,className:"ml-auto inline-flex items-center gap-1 text-xs px-2 py-1 rounded border hover:bg-red-50 text-red-600 disabled:opacity-50",children:[e.jsx(me,{className:"h-3 w-3"})," ",P===t.id?"Removing...":"Remove"]})]})]})]},t.id)}),n.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground col-span-full",children:s("no_devices_found")})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:s("please_sign_in_to_view_devices")})};export{Ie as D,be as P,ye as S,Z as a};
