import{ab as S,u as E,i as L,H as I,r as t,j as s,ac as f,C as T,a as F,b as R,p as U,d as _,I as w,B,s as x}from"./index-pyDnZmym.js";import{a as l,L as j}from"./label-D7uTkZ5E.js";import{C as V}from"./circle-check-big-HeXS74tS.js";const A=()=>{const[c]=S(),i=E(),{updatePassword:v}=L(),{toast:e}=I(),[r,g]=t.useState(""),[d,N]=t.useState(""),[u,m]=t.useState(!1),[k,h]=t.useState(!1),[b,y]=t.useState(!0);t.useEffect(()=>{(async()=>{const{data:{session:n}}=await x.auth.getSession();if(n)h(!0);else{const o=c.get("access_token"),p=c.get("refresh_token");if(o&&p){const{data:P,error:q}=await x.auth.setSession({access_token:o,refresh_token:p});P.session?h(!0):(e({title:"Invalid reset link",description:"This password reset link is invalid or expired.",variant:"destructive"}),i("/"))}else e({title:"Invalid reset link",description:"This password reset link is invalid or expired.",variant:"destructive"}),i("/")}y(!1)})()},[c,i,e]);const C=async a=>{if(a.preventDefault(),!r||!d){e({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}if(r.length<6){e({title:"Error",description:"Password must be at least 6 characters",variant:"destructive"});return}if(r!==d){e({title:"Error",description:"Passwords do not match",variant:"destructive"});return}try{m(!0),await v(r),e({title:"Password updated",description:"Your password has been successfully updated."}),i("/dashboard")}catch(n){const o=n instanceof Error?n.message:"Unknown error";e({title:"Update failed",description:o,variant:"destructive"})}finally{m(!1)}};return b?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"h-4 w-4 animate-spin"}),s.jsx("span",{children:"Verifying reset link..."})]})}):k?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:s.jsxs(T,{className:"w-full max-w-md",children:[s.jsxs(F,{className:"text-center",children:[s.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:s.jsx(l,{className:"h-6 w-6 text-primary"})}),s.jsx(R,{children:"Reset Your Password"}),s.jsx(U,{children:"Enter your new password below"})]}),s.jsx(_,{children:s.jsxs("form",{onSubmit:C,className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(j,{htmlFor:"password",children:"New Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),s.jsx(w,{id:"password",type:"password",placeholder:"Enter new password",value:r,onChange:a=>g(a.target.value),className:"pl-10",required:!0,minLength:6})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(j,{htmlFor:"confirmPassword",children:"Confirm Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),s.jsx(w,{id:"confirmPassword",type:"password",placeholder:"Confirm new password",value:d,onChange:a=>N(a.target.value),className:"pl-10",required:!0,minLength:6})]})]}),s.jsx(B,{type:"submit",className:"w-full",disabled:u,children:u?s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating password..."]}):s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4"}),"Update Password"]})})]})})]})}):null};export{A as default};
